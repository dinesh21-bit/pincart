<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pincart</title>

<link id="favicon" rel="icon" href="logo.png">

<style>
/* ===== YOUR ORIGINAL STYLES (UNCHANGED) ===== */
body{
 background:#0f2027;
 color:white;
 font-family:Arial;
 margin:0;
}

header{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:20px;
 background:#111;
}

nav a{
 margin:0 15px;
 cursor:pointer;
}

button{
 padding:8px 15px;
 border:none;
 cursor:pointer;
}

.page{ display:none; padding:30px; }
.active{ display:block; }

.products{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
 gap:20px;
}

.card{
 background:#222;
 padding:15px;
 border-radius:10px;
}
</style>
</head>

<body>

<header>
 <h2>Pincart</h2>

 <nav>
   <a onclick="showPage('homePage')">Home</a>
   <a onclick="showPage('categoryPage')">Categories</a>
 </nav>

 <div>
  <!-- FIX 1: Button type corrected -->
  <button type="button" id="loginBtn">Login</button>
  <button type="button" id="logoutBtn" style="display:none;">Logout</button>
 </div>
</header>

<div id="homePage" class="page active">
 <h2>Trending Products</h2>
 <div class="products" id="productList"></div>
</div>

<div id="categoryPage" class="page">
 <h2>Categories</h2>
 <div id="categoryContainer"></div>
</div>

<div id="adminPanel" style="display:none;">
 <h3>Add Product</h3>

 <!-- FIX 5: prevent form refresh -->
 <form id="productForm">
  <input type="text" id="title" placeholder="Title"><br><br>
  <input type="text" id="desc" placeholder="Description"><br><br>
  <input type="number" id="price" placeholder="Price"><br><br>
  <input type="text" id="link" placeholder="Link"><br><br>
  <button type="submit">Add Product</button>
 </form>
</div>

<script type="module">

/* ================================
   FIX 2: DOMContentLoaded wrapper
================================ */
document.addEventListener("DOMContentLoaded", () => {

/* ================================
   Firebase (same as before)
================================ */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "YOUR_KEY",
 authDomain: "YOUR_AUTH",
 projectId: "YOUR_PROJECT",
 storageBucket: "YOUR_BUCKET",
 messagingSenderId: "YOUR_ID",
 appId: "YOUR_APP"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================================
   FIX 3 + 4: Correct ID matching
================================ */

const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const adminPanel = document.getElementById("adminPanel");
const productForm = document.getElementById("productForm");

/* ================================
   Navigation
================================ */
window.showPage = function(page){
 document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
 document.getElementById(page).classList.add("active");
};

/* ================================
   Login Button Working
================================ */
loginBtn.addEventListener("click", () => {
 const email = prompt("Enter Email:");
 const password = prompt("Enter Password:");
 signInWithEmailAndPassword(auth,email,password)
  .catch(err=>alert(err.message));
});

/* ================================
   Logout Button Working
================================ */
logoutBtn.addEventListener("click", () => {
 signOut(auth);
});

/* ================================
   Auth State
================================ */
onAuthStateChanged(auth, (user)=>{
 if(user){
  loginBtn.style.display="none";
  logoutBtn.style.display="inline-block";
  adminPanel.style.display="block";
 }else{
  loginBtn.style.display="inline-block";
  logoutBtn.style.display="none";
  adminPanel.style.display="none";
 }
});

/* ================================
   FIX 5: Prevent Form Refresh
================================ */
productForm.addEventListener("submit", async (e)=>{
 e.preventDefault(); // stops page reload

 const title = document.getElementById("title").value;
 const desc = document.getElementById("desc").value;
 const price = document.getElementById("price").value;
 const link = document.getElementById("link").value;

 await addDoc(collection(db,"products"),{
  title, desc, price, link
 });

 alert("Product Added!");
 productForm.reset();
});

});
</script>

</body>
</html>
