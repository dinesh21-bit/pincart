<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pincart - Trending Products</title>

<style>

/* =========================================================
   GLOBAL RESET
========================================================= */

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body{
background:#f4f6f9;
min-height:100vh;
transition:background 0.3s ease,color 0.3s ease;
}

/* =========================================================
   DARK MODE
========================================================= */

body.dark-mode{
background:#111;
color:#eee;
}

body.dark-mode .card{
background:#1e1e1e;
color:white;
}

body.dark-mode nav{
background:#000;
}

/* =========================================================
   NAVBAR
========================================================= */

nav{
background:#111;
color:white;
display:flex;
justify-content:space-between;
align-items:center;
padding:15px 30px;
position:sticky;
top:0;
z-index:1000;
box-shadow:0 4px 10px rgba(0,0,0,0.2);
}

.logo-area{
display:flex;
align-items:center;
gap:12px;
}

#siteLogo{
width:45px;
height:45px;
border-radius:8px;
object-fit:cover;
transition:0.3s;
}

.brand-name{
font-size:22px;
font-weight:bold;
letter-spacing:1px;
}

.nav-links{
display:flex;
gap:15px;
align-items:center;
}

.nav-links button{
background:#ff4d4d;
border:none;
padding:8px 15px;
color:white;
border-radius:6px;
cursor:pointer;
transition:0.3s;
}

.nav-links button:hover{
background:#ff1a1a;
}

/* =========================================================
   HAMBURGER (MOBILE)
========================================================= */

.hamburger{
display:none;
flex-direction:column;
gap:5px;
cursor:pointer;
}

.hamburger span{
width:25px;
height:3px;
background:white;
}

/* =========================================================
   SEARCH BAR
========================================================= */

.search-container{
display:flex;
justify-content:center;
margin:25px 0;
position:sticky;
top:70px;
z-index:900;
background:inherit;
padding:10px;
}

#searchInput{
width:60%;
max-width:500px;
padding:12px 20px;
border-radius:30px;
border:1px solid #ccc;
outline:none;
transition:0.3s;
}

#searchInput:focus{
border-color:#ff4d4d;
box-shadow:0 0 10px rgba(255,77,77,0.3);
}

/* =========================================================
   CATEGORY FILTERS
========================================================= */

.category-bar{
display:flex;
justify-content:center;
gap:10px;
flex-wrap:wrap;
margin-bottom:20px;
}

.category-bar button{
padding:8px 15px;
border:none;
border-radius:20px;
background:#ddd;
cursor:pointer;
transition:0.3s;
}

.category-bar button:hover{
background:#ff4d4d;
color:white;
}

/* =========================================================
   FEATURED SECTION
========================================================= */

#featuredSection{
padding:20px;
text-align:center;
}

#featuredSection h2{
margin-bottom:15px;
}

/* =========================================================
   PRODUCT GRID
========================================================= */

#productList{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:20px;
padding:20px;
}

.card{
background:white;
border-radius:15px;
overflow:hidden;
box-shadow:0 10px 20px rgba(0,0,0,0.1);
transition:0.3s;
position:relative;
}

.card:hover{
transform:translateY(-6px);
}

.card img{
width:100%;
height:220px;
object-fit:cover;
}

.card-content{
padding:15px;
}

.card h3{
margin-bottom:10px;
font-size:18px;
}

.card button{
background:#111;
color:white;
border:none;
padding:8px 15px;
border-radius:6px;
cursor:pointer;
transition:0.3s;
}

.card button:hover{
background:#333;
}

/* =========================================================
   WISHLIST ICON
========================================================= */

.wishlist{
position:absolute;
top:10px;
right:10px;
background:white;
border-radius:50%;
padding:6px;
cursor:pointer;
box-shadow:0 2px 8px rgba(0,0,0,0.2);
}

.wishlist.active{
background:red;
color:white;
}

/* =========================================================
   ADMIN PANEL
========================================================= */

#adminPanel{
display:none;
background:white;
padding:25px;
margin:30px;
border-radius:15px;
box-shadow:0 10px 20px rgba(0,0,0,0.1);
animation:fadeIn 0.4s ease;
}

.admin-group{
margin-bottom:15px;
}

.admin-group input{
width:100%;
padding:10px;
margin-top:5px;
border-radius:6px;
border:1px solid #ccc;
}

.admin-group button{
margin-top:10px;
background:#111;
color:white;
padding:8px 15px;
border:none;
border-radius:6px;
cursor:pointer;
}

/* =========================================================
   TOAST NOTIFICATION
========================================================= */

#toast{
position:fixed;
bottom:20px;
right:20px;
background:#111;
color:white;
padding:15px 20px;
border-radius:10px;
display:none;
}

/* =========================================================
   LOADER
========================================================= */

#loader{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.5);
display:none;
justify-content:center;
align-items:center;
z-index:2000;
}

.loader-circle{
width:60px;
height:60px;
border:6px solid #fff;
border-top:6px solid #ff4d4d;
border-radius:50%;
animation:spin 1s linear infinite;
}

/* =========================================================
   ANIMATIONS
========================================================= */

@keyframes spin{
to{ transform:rotate(360deg); }
}

@keyframes fadeIn{
from{opacity:0;}
to{opacity:1;}
}

/* =========================================================
   RESPONSIVE DESIGN
========================================================= */

@media(max-width:768px){

nav{
flex-direction:row;
}

.nav-links{
display:none;
flex-direction:column;
background:#111;
position:absolute;
top:60px;
right:0;
padding:15px;
width:200px;
}

.nav-links.active{
display:flex;
}

.hamburger{
display:flex;
}

#searchInput{
width:90%;
}

}

</style>
</head>
<body>

<nav>
<div class="logo-area">
<img id="siteLogo" src="" alt="Logo">
<div class="brand-name">Pincart</div>
</div>

<div class="hamburger" onclick="toggleMenu()">
<span></span>
<span></span>
<span></span>
</div>

<div class="nav-links" id="navLinks">
<button onclick="toggleDarkMode()">Dark Mode</button>
<button onclick="showAdmin()">Admin</button>
<button onclick="logoutUser()">Logout</button>
</div>
</nav>

<div class="search-container">
<input type="text" id="searchInput" placeholder="Search trending products...">
</div>

<div class="category-bar">
<button onclick="filterCategory('all')">All</button>
<button onclick="filterCategory('tech')">Tech</button>
<button onclick="filterCategory('fashion')">Fashion</button>
<button onclick="filterCategory('home')">Home</button>
</div>

<section id="featuredSection">
<h2>üî• Featured Products</h2>
<div id="featuredProducts"></div>
</section>

<div id="productList"></div>

<div id="toast"></div>

<div id="loader">
<div class="loader-circle"></div>
</div>

<div id="adminPanel">
<h2>Admin Panel</h2>

<div class="admin-group">
<label>Product Name</label>
<input type="text" id="productName">
</div>

<div class="admin-group">
<label>Product Image URL</label>
<input type="text" id="productImage">
</div>

<div class="admin-group">
<label>Affiliate Link</label>
<input type="text" id="productLink">
</div>

<div class="admin-group">
<label>Category (tech/fashion/home)</label>
<input type="text" id="productCategory">
</div>

<div class="admin-group">
<button onclick="addProduct()">Add Product</button>
</div>

<hr><br>

<h3>Upload Logo (Permanent)</h3>
<input type="file" id="logoUpload">
<button onclick="uploadLogo()">Upload Logo</button>

<br><br>

<h3>Upload Background Image</h3>
<input type="file" id="bgUpload">
<button onclick="uploadBackground()">Upload Background</button>

</div>

 <script type="module">

/* =========================================================
   FIREBASE IMPORTS
========================================================= */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, onSnapshot, deleteDoc, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

/* =========================================================
   FIREBASE CONFIG (KEEP YOURS)
========================================================= */

const firebaseConfig = {
apiKey: "YOUR_API_KEY",
authDomain: "YOUR_AUTH_DOMAIN",
projectId: "YOUR_PROJECT_ID",
storageBucket: "YOUR_BUCKET",
messagingSenderId: "YOUR_ID",
appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const storage = getStorage(app);

/* =========================================================
   GLOBAL STATE
========================================================= */

let allProducts = [];
let currentCategory = "all";
let wishlist = JSON.parse(localStorage.getItem("wishlist")) || [];

/* =========================================================
   TOAST SYSTEM
========================================================= */

function showToast(message){
const toast = document.getElementById("toast");
toast.innerText = message;
toast.style.display="block";
setTimeout(()=>{ toast.style.display="none"; },3000);
}

/* =========================================================
   LOADER CONTROL
========================================================= */

function showLoader(){
document.getElementById("loader").style.display="flex";
}

function hideLoader(){
document.getElementById("loader").style.display="none";
}

/* =========================================================
   DARK MODE
========================================================= */

window.toggleDarkMode = function(){
document.body.classList.toggle("dark-mode");
}

/* =========================================================
   MOBILE MENU
========================================================= */

window.toggleMenu = function(){
document.getElementById("navLinks").classList.toggle("active");
}

/* =========================================================
   ADMIN VISIBILITY
========================================================= */

window.showAdmin = function(){
document.getElementById("adminPanel").style.display="block";
}

/* =========================================================
   LOGOUT
========================================================= */

window.logoutUser = function(){
signOut(auth);
showToast("Logged out");
}

/* =========================================================
   ADMIN EMAIL RESTRICTION
========================================================= */

onAuthStateChanged(auth,(user)=>{
if(user){
if(user.email !== "youradminemail@gmail.com"){
document.getElementById("adminPanel").style.display="none";
}
}
});

/* =========================================================
   ADD PRODUCT
========================================================= */

window.addProduct = async function(){

const name = document.getElementById("productName").value;
const image = document.getElementById("productImage").value;
const link = document.getElementById("productLink").value;
const category = document.getElementById("productCategory").value;

if(!name || !image || !link || !category){
showToast("Fill all fields");
return;
}

showLoader();

await addDoc(collection(db,"products"),{
name,
image,
link,
category,
views:0,
createdAt:Date.now()
});

hideLoader();
showToast("Product Added Successfully");
}

/* =========================================================
   REALTIME PRODUCT LISTENER
========================================================= */

onSnapshot(collection(db,"products"),(snapshot)=>{
allProducts = [];
snapshot.forEach(docSnap=>{
allProducts.push({id:docSnap.id,...docSnap.data()});
});
renderProducts();
renderFeatured();
});

/* =========================================================
   RENDER PRODUCTS
========================================================= */

function renderProducts(){

const productList = document.getElementById("productList");
productList.innerHTML="";

let filtered = allProducts;

if(currentCategory !== "all"){
filtered = filtered.filter(p=>p.category===currentCategory);
}

filtered.forEach(product=>{

productList.innerHTML+=`
<div class="card">
<div class="wishlist ${wishlist.includes(product.id) ? "active":""}" onclick="toggleWishlist('${product.id}')">‚ù§</div>
<img src="${product.image}" loading="lazy">
<div class="card-content">
<h3>${product.name}</h3>
<p>Views: ${product.views}</p>
<button onclick="trackView('${product.id}','${product.link}')">Buy Now</button>
<button onclick="deleteProduct('${product.id}')">Delete</button>
</div>
</div>
`;

});

}

/* =========================================================
   FEATURED PRODUCTS (Top 3 by Views)
========================================================= */

function renderFeatured(){
const featuredDiv = document.getElementById("featuredProducts");
featuredDiv.innerHTML="";

let topProducts = [...allProducts]
.sort((a,b)=>b.views - a.views)
.slice(0,3);

topProducts.forEach(p=>{
featuredDiv.innerHTML+=`
<div style="margin-bottom:10px;">
<strong>${p.name}</strong> - ${p.views} views
</div>
`;
});
}

/* =========================================================
   CATEGORY FILTER
========================================================= */

window.filterCategory = function(cat){
currentCategory = cat;
renderProducts();
}

/* =========================================================
   SEARCH FILTER
========================================================= */

document.getElementById("searchInput").addEventListener("input",function(){
const searchValue = this.value.toLowerCase();

const cards = document.querySelectorAll(".card");

cards.forEach(card=>{
const text = card.innerText.toLowerCase();
card.style.display = text.includes(searchValue) ? "block":"none";
});
});

/* =========================================================
   VIEW TRACKING
========================================================= */

window.trackView = async function(id,link){

await updateDoc(doc(db,"products",id),{
views:increment(1)
});

window.open(link,"_blank");
}

/* =========================================================
   DELETE PRODUCT
========================================================= */

window.deleteProduct = async function(id){

if(confirm("Delete this product?")){
await deleteDoc(doc(db,"products",id));
showToast("Product Deleted");
}

}

/* =========================================================
   WISHLIST SYSTEM
========================================================= */

window.toggleWishlist = function(id){

if(wishlist.includes(id)){
wishlist = wishlist.filter(item=>item!==id);
showToast("Removed from Wishlist");
}else{
wishlist.push(id);
showToast("Added to Wishlist");
}

localStorage.setItem("wishlist",JSON.stringify(wishlist));
renderProducts();
}

/* =========================================================
   LOGO UPLOAD PERMANENT
========================================================= */

window.uploadLogo = async function(){

const file = document.getElementById("logoUpload").files[0];
if(!file){ showToast("Select file"); return; }

showLoader();

const logoRef = ref(storage,"branding/logo.png");
await uploadBytes(logoRef,file);
const url = await getDownloadURL(logoRef);

localStorage.setItem("pincartLogo",url);
document.getElementById("siteLogo").src = url;

hideLoader();
showToast("Logo Updated");
}

/* Load Logo */
const savedLogo = localStorage.getItem("pincartLogo");
if(savedLogo){
document.getElementById("siteLogo").src = savedLogo;
}

/* =========================================================
   BACKGROUND UPLOAD PERMANENT
========================================================= */

window.uploadBackground = async function(){

const file = document.getElementById("bgUpload").files[0];
if(!file){ showToast("Select file"); return; }

showLoader();

const bgRef = ref(storage,"branding/background.png");
await uploadBytes(bgRef,file);
const url = await getDownloadURL(bgRef);

localStorage.setItem("pincartBG",url);
document.body.style.backgroundImage=`url(${url})`;
document.body.style.backgroundSize="cover";

hideLoader();
showToast("Background Updated");
}

/* Load Background */
const savedBG = localStorage.getItem("pincartBG");
if(savedBG){
document.body.style.backgroundImage=`url(${savedBG})`;
document.body.style.backgroundSize="cover";
}

/* =========================================================
   AUTO LOAD ON START
========================================================= */

renderProducts();
renderFeatured();

</script>
</body>
</html>
